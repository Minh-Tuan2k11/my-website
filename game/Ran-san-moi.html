
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Modern Snake Game - Advanced Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s;
            overflow: hidden;
            position: relative;
            padding: 10px;
        }

        .bottom-snake-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bottom-snake {
            position: absolute;
            display: flex;
            flex-direction: row;
            gap: 2px;
            animation: slideSnake 15s linear infinite;
        }

        .bottom-snake-segment {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideSnake {
            from { transform: translateX(-100%); }
            to { transform: translateX(100vw); }
        }

        .game-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            z-index: 1;
            position: relative;
            width: 100%;
            max-width: 1400px;
            justify-content: center;
        }

        @media (max-width: 1024px) {
            .game-container {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }
        }

        .status-panel, .controls-panel {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        @media (min-width: 1025px) {
            .status-panel, .controls-panel {
                width: 220px;
            }
        }

        @media (max-width: 1024px) {
            .status-panel, .controls-panel {
                width: 100%;
                max-width: 600px;
            }
        }

        .status-panel h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #4ade80;
            border-bottom: 2px solid #4ade80;
            padding-bottom: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 14px;
        }

        .game-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 1;
            width: 100%;
            max-width: min(90vw, 90vh, 600px);
        }

        #gameCanvas {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: block;
            width: 100%;
            height: auto;
            aspect-ratio: 1;
        }

        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }

        @media (max-width: 768px) {
            .mobile-controls {
                display: grid;
                grid-template-columns: repeat(3, 60px);
                grid-template-rows: repeat(3, 60px);
                gap: 5px;
            }
        }

        @media (max-width: 400px) {
            .mobile-controls {
                grid-template-columns: repeat(3, 50px);
                grid-template-rows: repeat(3, 50px);
                bottom: 50px;
            }
        }

        .mobile-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .mobile-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .mobile-btn-up { grid-column: 2; grid-row: 1; }
        .mobile-btn-left { grid-column: 1; grid-row: 2; }
        .mobile-btn-down { grid-column: 2; grid-row: 3; }
        .mobile-btn-right { grid-column: 3; grid-row: 2; }
        .mobile-btn-pause { grid-column: 2; grid-row: 2; font-size: 20px; }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            z-index: 10;
        }

        .overlay.hidden {
            display: none;
            pointer-events: none;
        }

        .overlay-content {
            text-align: center;
            color: white;
            padding: 40px 20px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        @media (max-width: 600px) {
            .overlay-content {
                padding: 20px 15px;
            }
        }

        .overlay-content h1 {
            font-size: clamp(36px, 8vw, 64px);
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        .overlay-content h2 {
            font-size: clamp(28px, 6vw, 48px);
            margin-bottom: 20px;
        }

        .overlay-content p {
            font-size: clamp(12px, 3vw, 14px);
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
            align-items: stretch;
        }

        .btn {
            padding: clamp(10px, 2vw, 15px) clamp(25px, 5vw, 40px);
            font-size: clamp(14px, 3vw, 18px);
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            white-space: nowrap;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: #22c55e;
            color: white;
        }

        .btn-primary:hover {
            background: #16a34a;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .btn-secondary {
            background: #a855f7;
            color: white;
        }

        .btn-secondary:hover {
            background: #9333ea;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }

        .btn-gray {
            background: #6b7280;
            color: white;
        }

        .btn-gray:hover {
            background: #4b5563;
        }

        .btn-settings {
            background: #3b82f6;
            color: white;
        }

        .btn-settings:hover {
            background: #2563eb;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .map-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .map-card {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            padding: clamp(15px, 4vw, 30px);
            border-radius: 12px;
            min-width: clamp(200px, 50vw, 300px);
            flex-shrink: 0;
        }

        .map-card h3 {
            font-size: clamp(18px, 4vw, 24px);
            margin-bottom: 10px;
        }

        .map-card p {
            font-size: clamp(12px, 3vw, 14px);
            margin: 5px 0;
        }

        .arrow-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 20px;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .arrow-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
        }

        .arrow-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .skin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
            max-width: 600px;
        }

        .skin-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .skin-card:hover {
            transform: scale(1.05);
        }

        .skin-card.active {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .skin-colors {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .settings-section {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
        }

        .settings-section h4 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .language-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: clamp(12px, 3vw, 14px);
        }

        .language-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .language-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .warning-notification {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            font-size: clamp(14px, 3vw, 20px);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 5;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translate(-50%, -100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .warning-collision { background: #dc2626; }
        .warning-wall { background: #f97316; }
        .warning-teleport { background: #3b82f6; }

        .start-notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: clamp(15px, 4vw, 30px) clamp(25px, 6vw, 50px);
            border-radius: 12px;
            text-align: center;
            z-index: 5;
            animation: pulse 2s infinite;
            max-width: 90%;
        }

        .start-notification h3 {
            color: white;
            font-size: clamp(16px, 4vw, 24px);
            margin-bottom: 10px;
        }

        .start-notification p {
            color: rgba(255, 255, 255, 0.7);
            font-size: clamp(11px, 2.5vw, 14px);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .hidden {
            display: none !important;
            pointer-events: none;
        }

        .pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
        }

        .pause-overlay.hidden {
            display: none;
            pointer-events: none;
        }

        .pause-icon {
            font-size: clamp(48px, 10vw, 64px);
            margin-bottom: 20px;
        }

        .score-breakdown {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .score-breakdown-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: clamp(12px, 3vw, 14px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.5);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box p:first-child {
            color: rgba(255, 255, 255, 0.7);
            font-size: clamp(10px, 2.5vw, 12px);
            margin-bottom: 5px;
        }

        .stat-box p:last-child {
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="bottom-snake-container">
        <div class="bottom-snake" id="bottomSnake"></div>
    </div>

    <div class="game-container">
        <div class="status-panel">
            <h3 data-translate="gameStats">Game Stats</h3>
            <div class="stat-item">
                <span class="stat-label" data-translate="score">Score:</span>
                <span class="stat-value" id="scoreDisplay">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-translate="level">Level:</span>
                <span class="stat-value" id="levelDisplay">1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-translate="length">Length:</span>
                <span class="stat-value" id="lengthDisplay">1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-translate="time">Time:</span>
                <span class="stat-value" id="timeDisplay">0s</span>
            </div>
            <div class="stat-item" id="comboContainer" style="display: none;">
                <span class="stat-label" data-translate="combo">Combo:</span>
                <span class="stat-value combo-indicator" id="comboDisplay">x0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-translate="mode">Mode:</span>
                <span class="stat-value" id="modeDisplay">Classic</span>
            </div>
        </div>

        <div class="game-wrapper">
            <canvas id="gameCanvas" width="400" height="400"></canvas>

            <div id="startNotification" class="start-notification hidden">
                <h3 data-translate="pressArrowStart">Press Any Arrow Key to Start</h3>
                <p data-translate="snakeMoveInfo">The snake will move when you make your first move</p>
            </div>

            <div id="warningNotification" class="warning-notification hidden"></div>

            <div id="pauseOverlay" class="pause-overlay hidden">
                <div class="pause-content">
                    <div class="pause-icon">‚è∏</div>
                    <h2 data-translate="paused">Paused</h2>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);" data-translate="pressToResume">Press P or ESC to resume</p>
                    <button class="btn btn-primary" onclick="game.togglePause()" data-translate="resume">Resume</button>
                </div>
            </div>

            <div id="introScreen" class="overlay">
                <div class="overlay-content">
                    <h1>SNAKE</h1>
                    <p data-translate="modernEdition">Modern Edition - Advanced Features</p>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="game.showMapSelect()">
                            ‚ñ∂ <span data-translate="play">Play</span>
                        </button>
                        <button class="btn btn-secondary" onclick="game.showSkinSelect()">
                            üé® <span data-translate="skins">Skins</span>
                        </button>
                        <button class="btn btn-settings" onclick="game.showSettings()">
                            ‚öôÔ∏è <span data-translate="settings">Settings</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="settingsScreen" class="overlay hidden">
                <div class="overlay-content">
                    <h2 data-translate="settings">Settings</h2>
                    <div class="settings-section">
                        <h4 data-translate="language">Language</h4>
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="language-btn active" onclick="game.setLanguage('en')" id="langBtnEn">
                                üá¨üáß English
                            </button>
                            <button class="language-btn" onclick="game.setLanguage('vi')" id="langBtnVi">
                                üáªüá≥ Ti·∫øng Vi·ªát
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-gray" onclick="game.showIntro()" style="margin-top: 20px;" data-translate="back">Back to Menu</button>
                </div>
            </div>

            <div id="mapScreen" class="overlay hidden">
                <div class="overlay-content">
                    <h2 data-translate="selectMap">Select Map</h2>
                    <div class="map-selector">
                        <button class="arrow-btn" onclick="game.prevMap()">‚óÄ</button>
                        <div class="map-card">
                            <h3 id="mapName">Classic Mode</h3>
                            <p id="mapDescription">Hit walls = Game Over</p>
                            <p style="font-size: 12px; margin-top: 10px; color: rgba(255,255,255,0.6);" id="mapEffect">Effect: pulse</p>
                        </div>
                        <button class="arrow-btn" onclick="game.nextMap()">‚ñ∂</button>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="game.startGame()" data-translate="startGame">Start Game</button>
                        <button class="btn btn-gray" onclick="game.showIntro()" data-translate="back">Back</button>
                    </div>
                </div>
            </div>

            <div id="skinScreen" class="overlay hidden">
                <div class="overlay-content">
                    <h2 data-translate="customizeSkins">Customize Skins</h2>
                    <p data-translate="skinEffects">Each skin has unique visual effects</p>
                    <div class="skin-grid" id="skinGrid"></div>
                    <button class="btn btn-gray" onclick="game.showIntro()" style="margin-top: 20px;" data-translate="backToMenu">Back to Menu</button>
                </div>
            </div>

            <div id="gameOverScreen" class="overlay hidden">
                <div class="overlay-content">
                    <h2 style="color: #ef4444;" data-translate="gameOver">Game Over!</h2>
                    <div class="score-breakdown">
                        <p style="font-size: clamp(36px, 8vw, 48px); color: #fbbf24; margin-bottom: 10px;" id="finalScore">0</p>
                        <p style="font-size: clamp(12px, 3vw, 14px); color: rgba(255,255,255,0.7); margin-bottom: 15px;" data-translate="finalScore">Final Score</p>
                        <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
                            <div class="score-breakdown-item">
                                <span style="color: rgba(255,255,255,0.7);" data-translate="baseScore">Base Score:</span>
                                <span id="baseScore">0</span>
                            </div>
                            <div class="score-breakdown-item">
                                <span style="color: rgba(255,255,255,0.7);" data-translate="comboBonus">Combo Bonus:</span>
                                <span style="color: #fbbf24;" id="comboScore">0</span>
                            </div>
                            <div class="score-breakdown-item">
                                <span style="color: rgba(255,255,255,0.7);" data-translate="speedBonus">Speed Bonus:</span>
                                <span style="color: #4ade80;" id="timeScore">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <p data-translate="level">Level</p>
                            <p id="finalLevel">1</p>
                        </div>
                        <div class="stat-box">
                            <p data-translate="length">Length</p>
                            <p id="finalLength">1</p>
                        </div>
                        <div class="stat-box">
                            <p data-translate="time">Time</p>
                            <p id="finalTime">0s</p>
                        </div>
                        <div class="stat-box">
                            <p data-translate="maxCombo">Max Combo</p>
                            <p id="finalCombo">x0</p>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="game.restartGame()">üîÑ <span data-translate="restartGame">Restart Game</span></button>
                        <button class="btn btn-gray" onclick="game.showIntro()">üè† <span data-translate="mainMenu">Main Menu</span></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-panel">
            <h4 data-translate="controls">Controls</h4>
            <p><kbd>‚Üë</kbd> <kbd>‚Üì</kbd> <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <span data-translate="move">Move</span></p>
            <p><kbd>W</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd> <span data-translate="move">Move</span></p>
            <p><kbd>P</kbd> or <kbd>ESC</kbd> <span data-translate="pause">Pause</span></p>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                <h4 style="margin-bottom: 10px;" data-translate="features">Features</h4>
                <p style="font-size: 11px;" data-translate="warningSystem">‚Ä¢ Warning System</p>
                <p style="font-size: 11px;" data-translate="comboScoring">‚Ä¢ Combo Scoring</p>
                <p style="font-size: 11px;" data-translate="speedBonus">‚Ä¢ Speed Bonus</p>
                <p style="font-size: 11px;" data-translate="visualEffects">‚Ä¢ Visual Effects</p>
                <p style="font-size: 11px;" data-translate="autoPause">‚Ä¢ Auto-pause</p>
            </div>
        </div>
    </div>

    <div class="mobile-controls">
        <div class="mobile-btn mobile-btn-up" ontouchstart="game.mobileControl('up')">‚Üë</div>
        <div class="mobile-btn mobile-btn-left" ontouchstart="game.mobileControl('left')">‚Üê</div>
        <div class="mobile-btn mobile-btn-pause" ontouchstart="game.togglePause()">‚è∏</div>
        <div class="mobile-btn mobile-btn-right" ontouchstart="game.mobileControl('right')">‚Üí</div>
        <div class="mobile-btn mobile-btn-down" ontouchstart="game.mobileControl('down')">‚Üì</div>
    </div>

    <script>
        var TRANSLATIONS = {
            en: {
                gameStats: 'Game Stats', score: 'Score:', level: 'Level:', length: 'Length:', time: 'Time:',
                combo: 'Combo:', mode: 'Mode:', pressArrowStart: 'Press Any Arrow Key to Start',
                snakeMoveInfo: 'The snake will move when you make your first move', paused: 'Paused',
                pressToResume: 'Press P or ESC to resume', resume: 'Resume',
                modernEdition: 'Modern Edition - Advanced Features', play: 'Play', skins: 'Skins',
                settings: 'Settings', language: 'Language', back: 'Back', selectMap: 'Select Map',
                startGame: 'Start Game', customizeSkins: 'Customize Skins',
                skinEffects: 'Each skin has unique visual effects', backToMenu: 'Back to Menu',
                gameOver: 'Game Over!', finalScore: 'Final Score', baseScore: 'Base Score:',
                comboBonus: 'Combo Bonus:', speedBonus: 'Speed Bonus:', maxCombo: 'Max Combo',
                restartGame: 'Restart Game', mainMenu: 'Main Menu', controls: 'Controls',
                move: 'Move', pause: 'Pause', features: 'Features', warningSystem: '‚Ä¢ Warning System',
                comboScoring: '‚Ä¢ Combo Scoring', visualEffects: '‚Ä¢ Visual Effects',
                autoPause: '‚Ä¢ Auto-pause', collisionRisk: '‚ö† Collision Risk!',
                wallAhead: '‚ö† Wall Ahead!', obstacleAhead: '‚ö† Obstacle Ahead!',
                teleporting: '‚áÑ Teleporting...', classicMode: 'Classic Mode',
                classicDesc: 'Hit walls = Game Over', mazeMode: 'Maze Mode',
                mazeDesc: 'Navigate through obstacles', infiniteMode: 'Infinite Mode',
                infiniteDesc: 'Wrap around walls'
            },
            vi: {
                gameStats: 'Th·ªëng K√™ Tr√≤ Ch∆°i', score: 'ƒêi·ªÉm:', level: 'C·∫•p ƒë·ªô:', length: 'ƒê·ªô d√†i:',
                time: 'Th·ªùi gian:', combo: 'Combo:', mode: 'Ch·∫ø ƒë·ªô:',
                pressArrowStart: 'Nh·∫•n Ph√≠m M≈©i T√™n ƒê·ªÉ B·∫Øt ƒê·∫ßu',
                snakeMoveInfo: 'R·∫Øn s·∫Ω di chuy·ªÉn khi b·∫°n th·ª±c hi·ªán n∆∞·ªõc ƒëi ƒë·∫ßu ti√™n',
                paused: 'ƒê√£ T·∫°m D·ª´ng', pressToResume: 'Nh·∫•n P ho·∫∑c ESC ƒë·ªÉ ti·∫øp t·ª•c',
                resume: 'Ti·∫øp T·ª•c', modernEdition: 'Phi√™n B·∫£n Hi·ªán ƒê·∫°i - T√≠nh NƒÉng N√¢ng Cao',
                play: 'Ch∆°i', skins: 'Giao Di·ªán', settings: 'C√†i ƒê·∫∑t', language: 'Ng√¥n Ng·ªØ',
                back: 'Quay L·∫°i', selectMap: 'Ch·ªçn B·∫£n ƒê·ªì', startGame: 'B·∫Øt ƒê·∫ßu Tr√≤ Ch∆°i',
                customizeSkins: 'T√πy Ch·ªânh Giao Di·ªán',
                skinEffects: 'M·ªói giao di·ªán c√≥ hi·ªáu ·ª©ng h√¨nh ·∫£nh ƒë·ªôc ƒë√°o',
                backToMenu: 'V·ªÅ Menu Ch√≠nh', gameOver: 'Tr√≤ Ch∆°i K·∫øt Th√∫c!',
                finalScore: 'ƒêi·ªÉm Cu·ªëi C√πng', baseScore: 'ƒêi·ªÉm C∆° B·∫£n:', comboBonus: 'ƒêi·ªÉm Combo:',
                speedBonus: 'ƒêi·ªÉm T·ªëc ƒê·ªô:', maxCombo: 'Combo T·ªëi ƒêa', restartGame: 'Ch∆°i L·∫°i',
                mainMenu: 'Menu Ch√≠nh', controls: 'ƒêi·ªÅu Khi·ªÉn', move: 'Di Chuy·ªÉn',
                pause: 'T·∫°m D·ª´ng', features: 'T√≠nh NƒÉng', warningSystem: '‚Ä¢ H·ªá Th·ªëng C·∫£nh B√°o',
                comboScoring: '‚Ä¢ ƒêi·ªÉm Combo', visualEffects: '‚Ä¢ Hi·ªáu ·ª®ng H√¨nh ·∫¢nh',
                autoPause: '‚Ä¢ T·ª± ƒê·ªông T·∫°m D·ª´ng', collisionRisk: '‚ö† Nguy C∆° Va Ch·∫°m!',
                wallAhead: '‚ö† C√≥ T∆∞·ªùng Ph√≠a Tr∆∞·ªõc!', obstacleAhead: '‚ö† C√≥ Ch∆∞·ªõng Ng·∫°i V·∫≠t!',
                teleporting: '‚áÑ ƒêang D·ªãch Chuy·ªÉn...', classicMode: 'Ch·∫ø ƒê·ªô C·ªï ƒêi·ªÉn',
                classicDesc: 'Ch·∫°m t∆∞·ªùng = Thua cu·ªôc', mazeMode: 'Ch·∫ø ƒê·ªô M√™ Cung',
                mazeDesc: 'Di chuy·ªÉn qua ch∆∞·ªõng ng·∫°i v·∫≠t', infiniteMode: 'Ch·∫ø ƒê·ªô V√¥ H·∫°n',
                infiniteDesc: 'Xuy√™n qua t∆∞·ªùng'
            }
        };

        var GRID_SIZE = 20;
        var CELL_SIZE = 20;
        var INITIAL_SPEED = 150;
        var WARNING_DURATION = 500;

        var SKINS = {
            classic: {
                name: 'Classic',
                snake: { head: '#2d5016', body: '#4a7c23', glow: '#6bc947' },
                apple: '#dc2626',
                bg: '#1a1a1a',
                particle: '#6bc947'
            },
            neon: {
                name: 'Neon Cyber',
                snake: { head: '#ff00ff', body: '#00ffff', glow: '#ff00ff' },
                apple: '#ffff00',
                bg: '#0a0a1a',
                particle: '#00ffff'
            },
            pixel: {
                name: 'Pixel Retro',
                snake: { head: '#ff6b6b', body: '#feca57', glow: '#feca57' },
                apple: '#48dbfb',
                bg: '#2c2c54',
                particle: '#48dbfb'
            },
            nature: {
                name: 'Nature',
                snake: { head: '#2d6a4f', body: '#52b788', glow: '#95d5b2' },
                apple: '#e63946',
                bg: '#d8f3dc',
                particle: '#52b788'
            },
            space: {
                name: 'Space',
                snake: { head: '#4361ee', body: '#7209b7', glow: '#4361ee' },
                apple: '#f72585',
                bg: '#0d1b2a',
                particle: '#7209b7'
            },
            dark: {
                name: 'Dark Mode',
                snake: { head: '#495057', body: '#6c757d', glow: '#adb5bd' },
                apple: '#e63946',
                bg: '#212529',
                particle: '#6c757d'
            }
        };

        var MAPS = [
            { id: 'classic', name: 'classicMode', description: 'classicDesc', effect: 'pulse' },
            { id: 'maze', name: 'mazeMode', description: 'mazeDesc', effect: 'glow' },
            { id: 'infinite', name: 'infiniteMode', description: 'infiniteDesc', effect: 'distort' }
        ];

        function SnakeGame() {
            this.canvas = document.getElementById('gameCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.selectedMap = 0;
            this.selectedSkin = 'classic';
            this.currentLanguage = 'en';
            this.gameState = 'intro';
            this.snake = [{ x: 10, y: 10 }];
            this.direction = { x: 0, y: 0 };
            this.nextDirection = { x: 0, y: 0 };
            this.apple = { x: 15, y: 10 };
            this.score = 0;
            this.level = 1;
            this.combo = 0;
            this.speed = INITIAL_SPEED;
            this.obstacles = [];
            this.particles = [];
            this.paused = false;
            this.gameOver = false;
            this.gameStarted = false;
            this.totalTime = 0;
            this.scoreBreakdown = { base: 0, combo: 0, time: 0 };
            this.lastAppleTime = Date.now();
            this.gameLoop = null;
            this.timeInterval = null;
            this.introSnake = [{ x: 5, y: 10 }, { x: 6, y: 10 }, { x: 7, y: 10 }];
            this.introDirection = { x: 1, y: 0 };
            
            this.init();
        }

        SnakeGame.prototype.init = function() {
            this.setupEventListeners();
            this.renderSkinGrid();
            this.updateMapDisplay();
            this.startIntroAnimation();
            this.updateUI();
            this.initBottomSnake();
            this.updateBackgroundColor();
        };

        SnakeGame.prototype.initBottomSnake = function() {
            var container = document.getElementById('bottomSnake');
            var skin = SKINS[this.selectedSkin];
            container.innerHTML = '';
            
            for (var i = 0; i < 10; i++) {
                var segment = document.createElement('div');
                segment.className = 'bottom-snake-segment';
                segment.style.backgroundColor = i === 0 ? skin.snake.head : skin.snake.body;
                container.appendChild(segment);
            }
        };

        SnakeGame.prototype.updateBottomSnake = function() {
            var container = document.getElementById('bottomSnake');
            var skin = SKINS[this.selectedSkin];
            var segments = container.children;
            
            for (var i = 0; i < segments.length; i++) {
                segments[i].style.backgroundColor = i === 0 ? skin.snake.head : skin.snake.body;
            }
        };

        SnakeGame.prototype.updateBackgroundColor = function() {
            document.body.style.backgroundColor = SKINS[this.selectedSkin].bg;
        };

        SnakeGame.prototype.setLanguage = function(lang) {
            this.currentLanguage = lang;
            
            document.getElementById('langBtnEn').classList.toggle('active', lang === 'en');
            document.getElementById('langBtnVi').classList.toggle('active', lang === 'vi');
            
            var elements = document.querySelectorAll('[data-translate]');
            for (var i = 0; i < elements.length; i++) {
                var key = elements[i].getAttribute('data-translate');
                if (TRANSLATIONS[lang][key]) {
                    elements[i].textContent = TRANSLATIONS[lang][key];
                }
            }
            
            this.updateMapDisplay();
        };

        SnakeGame.prototype.showSettings = function() {
            this.gameState = 'settings';
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('settingsScreen').classList.remove('hidden');
        };

        SnakeGame.prototype.mobileControl = function(direction) {
            if (this.gameOver || this.paused) return;

            var newDir = null;
            switch(direction) {
                case 'up': newDir = { x: 0, y: -1 }; break;
                case 'down': newDir = { x: 0, y: 1 }; break;
                case 'left': newDir = { x: -1, y: 0 }; break;
                case 'right': newDir = { x: 1, y: 0 }; break;
            }

            if (!this.gameStarted) {
                this.gameStarted = true;
                this.direction = newDir;
                this.nextDirection = newDir;
                document.getElementById('startNotification').classList.add('hidden');
                return;
            }

            if (this.snake.length >= 2) {
                if (newDir.x === -this.direction.x && newDir.y === -this.direction.y) {
                    return;
                }
            }

            this.nextDirection = newDir;
        };

        SnakeGame.prototype.setupEventListeners = function() {
            var self = this;
            document.addEventListener('keydown', function(e) {
                self.handleKeyPress(e);
            });
            window.addEventListener('blur', function () {
                if (self.gameState === 'playing' && !self.gameOver && !self.paused) {
                    self.autoPause = true;
                    self.pause();
                }
            });
        };

        SnakeGame.prototype.handleKeyPress = function (e) {
            if (this.gameOver) return;

            const key = e.key;
            let newDir = null;

            switch (key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    newDir = { x: 0, y: -1 };
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    newDir = { x: 0, y: 1 };
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    newDir = { x: -1, y: 0 };
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    newDir = { x: 1, y: 0 };
                    break;
                case 'p':
                case 'P':
                case 'Escape':
                    this.togglePause();
                    return;
                default:
                    return;
            }

            if (this.paused) return;

            if (!this.gameStarted) {
                this.gameStarted = true;
                this.direction = newDir;
                this.nextDirection = newDir;
                document.getElementById('startNotification').classList.add('hidden');
                return;
            }

            if (this.snake.length >= 2) {
                if (newDir.x === -this.direction.x && newDir.y === -this.direction.y) {
                    return;
                }
            }

            this.nextDirection = newDir;
        };

        SnakeGame.prototype.startIntroAnimation = function() {
            var self = this;
            setInterval(function() {
                if (self.gameState !== 'intro') return;

                var head = self.introSnake[0];
                var newHead = {
                    x: head.x + self.introDirection.x,
                    y: head.y + self.introDirection.y
                };

                if (newHead.x < 0) newHead.x = GRID_SIZE - 1;
                if (newHead.x >= GRID_SIZE) newHead.x = 0;
                if (newHead.y < 0) newHead.y = GRID_SIZE - 1;
                if (newHead.y >= GRID_SIZE) newHead.y = 0;

                if (Math.random() < 0.1) {
                    var dirs = [{ x: 1, y: 0 }, { x: -1, y: 0 }, { x: 0, y: 1 }, { x: 0, y: -1 }];
                    self.introDirection = dirs[Math.floor(Math.random() * dirs.length)];
                }

                self.introSnake.unshift(newHead);
                self.introSnake = self.introSnake.slice(0, 6);
            }, 200);
        };

        SnakeGame.prototype.generateMaze = function(level) {
            var obs = [];
            var density = Math.min(0.1 + level * 0.02, 0.25);
            var count = Math.floor(GRID_SIZE * GRID_SIZE * density);

            for (var i = 0; i < count; i++) {
                var x, y, attempts = 0;
                do {
                    x = Math.floor(Math.random() * (GRID_SIZE - 4)) + 2;
                    y = Math.floor(Math.random() * (GRID_SIZE - 4)) + 2;
                    attempts++;
                    var collision = false;
                    for (var j = 0; j < obs.length; j++) {
                        if (obs[j].x === x && obs[j].y === y) {
                            collision = true;
                            break;
                        }
                    }
                } while (
                    attempts < 50 &&
                    (collision || (x === 10 && y === 10) || (x === 15 && y === 10))
                );
                if (attempts < 50) obs.push({ x: x, y: y });
            }
            return obs;
        };

        SnakeGame.prototype.generateApple = function() {
            var newApple, attempts = 0;
            do {
                newApple = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
                attempts++;
                var collision = false;
                for (var i = 0; i < this.snake.length; i++) {
                    if (this.snake[i].x === newApple.x && this.snake[i].y === newApple.y) {
                        collision = true;
                        break;
                    }
                }
                if (!collision) {
                    for (var i = 0; i < this.obstacles.length; i++) {
                        if (this.obstacles[i].x === newApple.x && this.obstacles[i].y === newApple.y) {
                            collision = true;
                            break;
                        }
                    }
                }
            } while (attempts < 100 && collision);
            this.apple = newApple;
        };

        SnakeGame.prototype.createParticles = function(x, y) {
            for (var i = 0; i < 8; i++) {
                this.particles.push({
                    x: x * CELL_SIZE + CELL_SIZE / 2,
                    y: y * CELL_SIZE + CELL_SIZE / 2,
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    life: 1
                });
            }
        };

        SnakeGame.prototype.updateParticles = function() {
            var newParticles = [];
            for (var i = 0; i < this.particles.length; i++) {
                var p = this.particles[i];
                var updated = {
                    x: p.x + p.vx,
                    y: p.y + p.vy,
                    vx: p.vx,
                    vy: p.vy + 0.2,
                    life: p.life - 0.05
                };
                if (updated.life > 0) {
                    newParticles.push(updated);
                }
            }
            this.particles = newParticles;
        };

        SnakeGame.prototype.initGame = function () {
            this.snake = [{ x: 10, y: 10 }, { x: 9, y: 10 }];
            this.direction = { x: 0, y: 0 };
            this.nextDirection = { x: 0, y: 0 };
            this.score = 0;
            this.level = 1;
            this.combo = 0;
            this.speed = INITIAL_SPEED;
            this.paused = false;
            this.gameOver = false;
            this.gameStarted = false;
            this.totalTime = 0;
            this.lastAppleTime = Date.now();
            this.particles = [];
            this.scoreBreakdown = { base: 0, combo: 0, time: 0 };

            if (MAPS[this.selectedMap].id === 'maze') {
                this.obstacles = this.generateMaze(this.level);
            } else {
                this.obstacles = [];
            }

            this.generateApple();
            document.getElementById('startNotification').classList.remove('hidden');
            document.getElementById('pauseOverlay').classList.add('hidden');
            this.updateUI();
            this.render();
        };

        SnakeGame.prototype.startGameLoop = function() {
            if (this.gameLoop) clearInterval(this.gameLoop);
            if (this.timeInterval) clearInterval(this.timeInterval);

            var self = this;
            this.gameLoop = setInterval(function() {
                if (!self.paused && !self.gameOver && self.gameStarted) {
                    self.update();
                    self.updateParticles();
                }
                self.render();
            }, this.speed);

            this.timeInterval = setInterval(function() {
                if (!self.paused && !self.gameOver && self.gameStarted) {
                    self.totalTime++;
                    self.updateUI();
                }
            }, 1000);
        };

        SnakeGame.prototype.update = function() {
            this.direction = this.nextDirection;
            var head = this.snake[0];
            var newHead = {
                x: head.x + this.direction.x,
                y: head.y + this.direction.y
            };

            var mapMode = MAPS[this.selectedMap].id;

            if (mapMode === 'infinite') {
                if (newHead.x < 0) newHead.x = GRID_SIZE - 1;
                if (newHead.x >= GRID_SIZE) newHead.x = 0;
                if (newHead.y < 0) newHead.y = GRID_SIZE - 1;
                if (newHead.y >= GRID_SIZE) newHead.y = 0;
            }

            if (mapMode === 'classic' || mapMode === 'maze') {
                if (newHead.x < 0 || newHead.x >= GRID_SIZE || 
                    newHead.y < 0 || newHead.y >= GRID_SIZE) {
                    this.endGame();
                    return;
                }
            }

            if (mapMode === 'maze') {
                for (var i = 0; i < this.obstacles.length; i++) {
                    if (this.obstacles[i].x === newHead.x && this.obstacles[i].y === newHead.y) {
                        this.endGame();
                        return;
                    }
                }
            }

            if (this.snake.length >= 5) {
                for (var i = 0; i < this.snake.length; i++) {
                    if (this.snake[i].x === newHead.x && this.snake[i].y === newHead.y) {
                        this.endGame();
                        return;
                    }
                }
            }

            this.snake.unshift(newHead);

            if (newHead.x === this.apple.x && newHead.y === this.apple.y) {
                var now = Date.now();
                var timeSinceLastApple = now - this.lastAppleTime;
                this.lastAppleTime = now;

                var earnedScore = 10;
                this.combo++;
                var comboBonus = (this.combo - 1) * 2;
                var timeBonus = timeSinceLastApple < 2000 ? 5 : 0;
                var totalEarned = earnedScore + comboBonus + timeBonus;

                this.score += totalEarned;
                this.scoreBreakdown.base += earnedScore;
                this.scoreBreakdown.combo += comboBonus;
                this.scoreBreakdown.time += timeBonus;

                this.createParticles(this.apple.x, this.apple.y);
                this.generateApple();

                if (this.score % 50 === 0) {
                    this.level++;
                    this.speed = Math.max(50, this.speed - 10);
                    if (mapMode === 'maze') {
                        this.obstacles = this.generateMaze(this.level);
                    }
                    clearInterval(this.gameLoop);
                    this.startGameLoop();
                }
            } else {
                this.snake.pop();
                if (this.combo > 0) {
                    this.combo = 0;
                }
            }

            this.updateUI();
        };

        SnakeGame.prototype.render = function() {
            var skin = SKINS[this.selectedSkin];
            this.ctx.fillStyle = skin.bg;
            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

            this.ctx.strokeStyle = 'rgba(255,255,255,0.03)';
            this.ctx.lineWidth = 1;
            for (var i = 0; i <= GRID_SIZE; i++) {
                this.ctx.beginPath();
                this.ctx.moveTo(i * CELL_SIZE, 0);
                this.ctx.lineTo(i * CELL_SIZE, GRID_SIZE * CELL_SIZE);
                this.ctx.stroke();
                this.ctx.beginPath();
                this.ctx.moveTo(0, i * CELL_SIZE);
                this.ctx.lineTo(GRID_SIZE * CELL_SIZE, i * CELL_SIZE);
                this.ctx.stroke();
            }

            if (this.gameState === 'intro') {
                for (var i = 0; i < this.introSnake.length; i++) {
                    var segment = this.introSnake[i];
                    this.ctx.fillStyle = i === 0 ? skin.snake.head : skin.snake.body;
                    this.ctx.fillRect(segment.x * CELL_SIZE, segment.y * CELL_SIZE, CELL_SIZE - 2, CELL_SIZE - 2);
                }
            } else if (this.gameState === 'playing') {
                if (MAPS[this.selectedMap].id === 'maze') {
                    for (var i = 0; i < this.obstacles.length; i++) {
                        var obs = this.obstacles[i];
                        this.ctx.fillStyle = '#666';
                        this.ctx.fillRect(obs.x * CELL_SIZE, obs.y * CELL_SIZE, CELL_SIZE - 2, CELL_SIZE - 2);
                    }
                }

                var time = Date.now() / 1000;
                var appleScale = Math.sin(time * 4) * 0.15 + 1;
                this.ctx.fillStyle = skin.apple;
                this.ctx.shadowBlur = 20;
                this.ctx.shadowColor = skin.apple;
                this.ctx.beginPath();
                this.ctx.arc(
                    this.apple.x * CELL_SIZE + CELL_SIZE / 2,
                    this.apple.y * CELL_SIZE + CELL_SIZE / 2,
                    (CELL_SIZE / 2 - 2) * appleScale,
                    0,
                    Math.PI * 2
                );
                this.ctx.fill();
                this.ctx.shadowBlur = 0;

                for (var i = 0; i < this.particles.length; i++) {
                    var p = this.particles[i];
                    var alpha = Math.floor(p.life * 255).toString(16);
                    if (alpha.length === 1) alpha = '0' + alpha;
                    this.ctx.fillStyle = skin.particle + alpha;
                    this.ctx.fillRect(p.x - 2, p.y - 2, 4, 4);
                }

                for (var i = 0; i < this.snake.length; i++) {
                    var segment = this.snake[i];
                    var alpha = 1 - (i / this.snake.length) * 0.3;
                    this.ctx.fillStyle = i === 0 ? skin.snake.head : skin.snake.body;
                    
                    if (i === 0) {
                        this.ctx.shadowBlur = 15;
                        this.ctx.shadowColor = skin.snake.glow;
                    }
                    
                    this.ctx.globalAlpha = alpha;
                    this.ctx.fillRect(segment.x * CELL_SIZE, segment.y * CELL_SIZE, CELL_SIZE - 2, CELL_SIZE - 2);
                    this.ctx.globalAlpha = 1;
                    this.ctx.shadowBlur = 0;

                    if (i === 0) {
                        this.ctx.fillStyle = 'rgba(255,255,255,0.8)';
                        this.ctx.fillRect(segment.x * CELL_SIZE + CELL_SIZE / 3, segment.y * CELL_SIZE + CELL_SIZE / 4, 3, 3);
                        this.ctx.fillRect(segment.x * CELL_SIZE + 2 * CELL_SIZE / 3, segment.y * CELL_SIZE + CELL_SIZE / 4, 3, 3);
                    }
                }

                if (this.snake.length > 0 && this.gameStarted) {
                    var head = this.snake[0];
                    var indicatorX = head.x * CELL_SIZE + CELL_SIZE / 2 + this.nextDirection.x * CELL_SIZE * 0.7;
                    var indicatorY = head.y * CELL_SIZE + CELL_SIZE / 2 + this.nextDirection.y * CELL_SIZE * 0.7;
                    
                    this.ctx.fillStyle = skin.snake.glow + '80';
                    this.ctx.beginPath();
                    this.ctx.arc(indicatorX, indicatorY, 3, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }

            const startNotice = document.getElementById('startNotification');
            if (this.gameStarted) {
                startNotice.classList.add('hidden');
            } else {
                startNotice.classList.remove('hidden');
            }
        };

        SnakeGame.prototype.updateUI = function() {
            document.getElementById('scoreDisplay').textContent = this.score;
            document.getElementById('levelDisplay').textContent = this.level;
            document.getElementById('lengthDisplay').textContent = this.snake.length;
            document.getElementById('timeDisplay').textContent = this.totalTime + 's';
            
            var mapName = MAPS[this.selectedMap].name;
            document.getElementById('modeDisplay').textContent = TRANSLATIONS[this.currentLanguage][mapName].replace(' Mode', '').replace(' Ch·∫ø ƒê·ªô', '');

            var comboContainer = document.getElementById('comboContainer');
            if (this.combo > 0) {
                comboContainer.style.display = 'flex';
                document.getElementById('comboDisplay').textContent = 'x' + this.combo;
            } else {
                comboContainer.style.display = 'none';
            }
        };

        SnakeGame.prototype.togglePause = function () {
            if (this.paused) {
                this.paused = false;
                this.autoPause = false;
                document.getElementById('pauseOverlay').classList.add('hidden');
            } else {
                this.paused = true;
                this.autoPause = false;
                document.getElementById('pauseOverlay').classList.remove('hidden');
            }
        };

        SnakeGame.prototype.pause = function () {
            if (this.paused) return;
            this.paused = true;
            document.getElementById('pauseOverlay').classList.remove('hidden');
        };

        SnakeGame.prototype.endGame = function() {
            this.gameOver = true;
            this.gameStarted = false;
            
            document.getElementById('finalScore').textContent = this.score;
            document.getElementById('baseScore').textContent = this.scoreBreakdown.base;
            document.getElementById('comboScore').textContent = this.scoreBreakdown.combo;
            document.getElementById('timeScore').textContent = this.scoreBreakdown.time;
            document.getElementById('finalLevel').textContent = this.level;
            document.getElementById('finalLength').textContent = this.snake.length;
            document.getElementById('finalTime').textContent = this.totalTime + 's';
            document.getElementById('finalCombo').textContent = 'x' + Math.max(this.combo, 0);

            document.getElementById('gameOverScreen').classList.remove('hidden');
        };

        SnakeGame.prototype.showIntro = function() {
            this.gameState = 'intro';
            document.getElementById('introScreen').classList.remove('hidden');
            document.getElementById('mapScreen').classList.add('hidden');
            document.getElementById('skinScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('settingsScreen').classList.add('hidden');
            this.updateBackgroundColor();
            this.render();
        };

        SnakeGame.prototype.showMapSelect = function() {
            this.gameState = 'mapSelect';
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('mapScreen').classList.remove('hidden');
            this.updateMapDisplay();
        };

        SnakeGame.prototype.showSkinSelect = function() {
            this.gameState = 'skinSelect';
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('skinScreen').classList.remove('hidden');
        };

        SnakeGame.prototype.startGame = function() {
            this.gameState = 'playing';
            document.getElementById('mapScreen').classList.add('hidden');
            this.initGame();
            this.startGameLoop();
            this.updateBackgroundColor();
        };

        SnakeGame.prototype.restartGame = function() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            this.initGame();
            this.startGameLoop();
        };

        SnakeGame.prototype.prevMap = function() {
            if (this.selectedMap > 0) {
                this.selectedMap--;
                this.updateMapDisplay();
            }
        };

        SnakeGame.prototype.nextMap = function() {
            if (this.selectedMap < MAPS.length - 1) {
                this.selectedMap++;
                this.updateMapDisplay();
            }
        };

        SnakeGame.prototype.updateMapDisplay = function() {
            var map = MAPS[this.selectedMap];
            var lang = this.currentLanguage;
            document.getElementById('mapName').textContent = TRANSLATIONS[lang][map.name];
            document.getElementById('mapDescription').textContent = TRANSLATIONS[lang][map.description];
            document.getElementById('mapEffect').textContent = 'Effect: ' + map.effect;
        };

        SnakeGame.prototype.renderSkinGrid = function() {
            var grid = document.getElementById('skinGrid');
            grid.innerHTML = '';
            var self = this;

            var skinKeys = Object.keys(SKINS);
            for (var i = 0; i < skinKeys.length; i++) {
                var key = skinKeys[i];
                var skin = SKINS[key];
                
                var card = document.createElement('div');
                card.className = 'skin-card';
                if (key === this.selectedSkin) card.classList.add('active');

                card.innerHTML = '<div style="font-weight: bold; margin-bottom: 10px;">' + skin.name + '</div>' +
                    '<div class="skin-colors">' +
                    '<div class="color-preview" style="background-color: ' + skin.snake.head + ';"></div>' +
                    '<div class="color-preview" style="background-color: ' + skin.apple + '; border-radius: 50%;"></div>' +
                    '</div>';

                card.onclick = (function(skinKey, skinData) {
                    return function() {
                        self.selectedSkin = skinKey;
                        self.updateBackgroundColor();
                        self.updateBottomSnake();
                        self.renderSkinGrid();
                        self.render();
                    };
                })(key, skin);

                grid.appendChild(card);
            }
        };

        var game = new SnakeGame();
    </script>
</body>
</html>