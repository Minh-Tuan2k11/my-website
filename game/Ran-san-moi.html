<!DOCTYPE html>
<html lang="vi">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ğŸ Ráº¯n SÄƒn Má»“i</title>
  <style>
    body {
      background-color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      color: white;
      font-family: Arial, sans-serif;
    }
    canvas {
      background-color: #111;
      border: 2px solid #0f0;
    }
    h1 {
      margin-bottom: 10px;
    }
    #startBtn, #toggleColorBtn, .skinBtn, #toggleMazeBtn, #modeToggleBtn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #0f0;
      color: #000;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    #startBtn:hover, #toggleColorBtn:hover, .skinBtn:hover, #toggleMazeBtn:hover, #modeToggleBtn:hover {
      background-color: #0c0;
    }
    #toggleColorBtn {
      background-color: #ff0;
    }
    .skinBtnsContainer {
      display: flex;
      margin-top: 10px;
    }
    .skinBtn {
      background-color: #444;
      margin: 0 5px;
      color: white;
    }
    .skinBtn:hover {
      background-color: #555;
    }
    #message {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 24px;
      color: #fff;
      background: rgba(0,0,0,0.6);
      padding: 10px 20px;
      border-radius: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>ğŸ Ráº¯n SÄƒn Má»“i</h1>
  <div id="message">HÃ£y di chuyá»ƒn Ä‘á»ƒ báº¯t Ä‘áº§u</div>
  <canvas id="gameCanvas" width="400" height="400"></canvas>
  <button id="startBtn">â–¶ Báº¯t Ä‘áº§u / ChÆ¡i láº¡i</button>
  <button id="toggleColorBtn">ğŸ”„ Báº­t/Táº¯t MÃ u Ngáº«u NhiÃªn</button>
  <button id="toggleMazeBtn">ğŸ”² Cháº¿ Äá»™ MÃª Cung</button>
  <button id="modeToggleBtn">ğŸŒ€ Cháº¿ Äá»™: TÆ°á»ng Xung Quanh</button>

  <div class="skinBtnsContainer">
    <button class="skinBtn" data-color="#0f0">Xanh lÃ¡</button>
    <button class="skinBtn" data-color="#00f">Xanh dÆ°Æ¡ng</button>
    <button class="skinBtn" data-color="#f00">Äá»</button>
    <button class="skinBtn" data-color="#ff0">VÃ ng</button>
    <button class="skinBtn" data-color="#fff">Tráº¯ng</button>
  </div>

<script>
/* ================== SETUP ================== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const startBtn = document.getElementById("startBtn");
const toggleColorBtn = document.getElementById("toggleColorBtn");
const toggleMazeBtn = document.getElementById("toggleMazeBtn");
const modeToggleBtn = document.getElementById("modeToggleBtn");
const message = document.getElementById("message");

let tileCount = 20;
let gridSize = 20;

/* ================== RESIZE ================== */
function resizeCanvas() {
  const size = Math.min(window.innerWidth, window.innerHeight) - 40;
  canvas.width = size;
  canvas.height = size;
  gridSize = canvas.width / tileCount;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

/* ================== GAME STATE ================== */
let snake = [];
let direction = { x: 0, y: 0 };
let food = {};
let score = 0;
let gameInterval;
let gameStarted = false;

let snakeColor = "#00ff88";
let randomColorEnabled = false;
let mazeMode = false;
let wallMode = false;

/* ================== MAZE ================== */
const mazeWalls = [
  ...Array.from({ length: 18 }, (_, i) => ({ x: i + 1, y: 1 })),
  ...Array.from({ length: 18 }, (_, i) => ({ x: i + 1, y: 18 })),
  ...Array.from({ length: 18 }, (_, i) => ({ x: 1, y: i + 1 })),
  ...Array.from({ length: 18 }, (_, i) => ({ x: 18, y: i + 1 })),
  ...Array.from({ length: 10 }, (_, i) => ({ x: 5, y: i + 4 })),
  ...Array.from({ length: 10 }, (_, i) => ({ x: 14, y: i + 6 })),
  ...Array.from({ length: 6 }, (_, i) => ({ x: i + 7, y: 8 })),
  ...Array.from({ length: 6 }, (_, i) => ({ x: i + 6, y: 13 }))
];

/* ================== UTILS ================== */
function getRandomColor() {
  return "#" + Math.floor(Math.random() * 16777215).toString(16);
}

function drawRoundedRect(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  ctx.fill();
}

/* ================== DRAW ================== */
function drawSnake() {
  snake.forEach((p, i) => {
    const x = p.x * gridSize + 1;
    const y = p.y * gridSize + 1;
    const size = gridSize - 2;
    const radius = i === 0 ? 4 : 2;

    ctx.fillStyle =
      randomColorEnabled && i ? getRandomColor() : snakeColor;

    drawRoundedRect(x, y, size, size, radius);
  });
}

function drawFood() {
  ctx.fillStyle = "#ff4444";
  ctx.beginPath();
  ctx.arc(
    food.x * gridSize + gridSize / 2,
    food.y * gridSize + gridSize / 2,
    gridSize / 3,
    0,
    Math.PI * 2
  );
  ctx.fill();
}

function drawMaze() {
  ctx.fillStyle = "#00cccc";
  mazeWalls.forEach(w => {
    ctx.fillRect(
      w.x * gridSize + 2,
      w.y * gridSize + 2,
      gridSize - 4,
      gridSize - 4
    );
  });
}

/* ================== GAME LOGIC ================== */
function moveSnake() {
  if (!gameStarted) return;

  let nx = snake[0].x + direction.x;
  let ny = snake[0].y + direction.y;

  if (wallMode) {
    if (nx < 0 || ny < 0 || nx >= tileCount || ny >= tileCount)
      return gameOver();
  } else {
    nx = (nx + tileCount) % tileCount;
    ny = (ny + tileCount) % tileCount;
  }

  const head = { x: nx, y: ny };

  if (snake.slice(1).some(s => s.x === head.x && s.y === head.y))
    return gameOver();

  if (mazeMode && mazeWalls.some(w => w.x === head.x && w.y === head.y))
    return gameOver();

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score++;
    spawnFood();
  } else {
    snake.pop();
  }
}

function spawnFood() {
  do {
    food = {
      x: Math.floor(Math.random() * tileCount),
      y: Math.floor(Math.random() * tileCount)
    };
  } while (
    snake.some(p => p.x === food.x && p.y === food.y) ||
    (mazeMode && mazeWalls.some(w => w.x === food.x && w.y === food.y))
  );
}

function draw() {
  ctx.fillStyle = "#111";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (mazeMode) drawMaze();
  moveSnake();
  drawSnake();
  drawFood();
}

function gameOver() {
  clearInterval(gameInterval);
  alert("ğŸª¦ Game Over! Äiá»ƒm: " + score);
}

/* ================== INPUT ================== */
document.addEventListener("keydown", e => {
  const map = {
    ArrowUp:{x:0,y:-1}, w:{x:0,y:-1},
    ArrowDown:{x:0,y:1}, s:{x:0,y:1},
    ArrowLeft:{x:-1,y:0}, a:{x:-1,y:0},
    ArrowRight:{x:1,y:0}, d:{x:1,y:0}
  };
  if (map[e.key]) {
    direction = map[e.key];
    gameStarted = true;
    message.style.display = "none";
  }
});

/* Swipe mobile */
let sx = 0, sy = 0;
canvas.addEventListener("touchstart", e => {
  sx = e.touches[0].clientX;
  sy = e.touches[0].clientY;
});
canvas.addEventListener("touchend", e => {
  const dx = e.changedTouches[0].clientX - sx;
  const dy = e.changedTouches[0].clientY - sy;
  direction = Math.abs(dx) > Math.abs(dy)
    ? (dx > 0 ? {x:1,y:0} : {x:-1,y:0})
    : (dy > 0 ? {x:0,y:1} : {x:0,y:-1});
  gameStarted = true;
  message.style.display = "none";
});

/* ================== CONTROLS ================== */
function startGame() {
  clearInterval(gameInterval);
  snake = [{ x: 10, y: 10 }];
  direction = { x: 0, y: 0 };
  score = 0;
  gameStarted = false;
  spawnFood();
  message.style.display = "block";
  gameInterval = setInterval(draw, 120);
}

startBtn.onclick = startGame;
toggleColorBtn.onclick = () => randomColorEnabled = !randomColorEnabled;
toggleMazeBtn.onclick = () => mazeMode = !mazeMode;
modeToggleBtn.onclick = () => wallMode = !wallMode;

/* ================== START ================== */
startGame();
</script>

</body>
</html>